---
import DocsLayout from "../../layouts/DocsLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const tutorials = await getCollection("tutorials");
  return tutorials.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Get all tutorials sorted for prev/next navigation
const allTutorials = await getCollection("tutorials");
const sorted = allTutorials.sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));
const currentIndex = sorted.findIndex((t) => t.id === entry.id);
const prevTutorial = currentIndex > 0 ? sorted[currentIndex - 1] : null;
const nextTutorial = currentIndex < sorted.length - 1 ? sorted[currentIndex + 1] : null;

const levelBadge = {
  beginner: { class: "badge-success", label: "Beginner" },
  intermediate: { class: "badge-warning", label: "Intermediate" },
  advanced: { class: "badge-error", label: "Advanced" },
};
const badge = levelBadge[entry.data.level ?? "beginner"];
---

<DocsLayout title={entry.data.title} description={entry.data.description}>
  <!-- Tutorial meta -->
  <div class="not-prose flex flex-wrap items-center gap-3 mb-6">
    <span class={`badge ${badge.class} badge-sm`}>{badge.label}</span>
    {entry.data.duration && (
      <span class="text-sm text-base-content/50 font-mono flex items-center gap-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        {entry.data.duration}
      </span>
    )}
  </div>

  <Content />

  <!-- Prev/Next navigation -->
  <div slot="pagination" class="flex justify-between gap-4">
    {prevTutorial ? (
      <a
        href={`/tutorials/${prevTutorial.id}`}
        class="glass-card rounded-xl p-4 flex-1 group no-underline max-w-[50%]"
      >
        <span class="text-xs text-base-content/40 font-display">Previous</span>
        <p class="text-sm font-display font-semibold text-base-content/80 group-hover:text-primary transition-colors mt-1">
          ← {prevTutorial.data.title}
        </p>
      </a>
    ) : <div />}

    {nextTutorial ? (
      <a
        href={`/tutorials/${nextTutorial.id}`}
        class="glass-card rounded-xl p-4 flex-1 group no-underline text-right max-w-[50%]"
      >
        <span class="text-xs text-base-content/40 font-display">Next</span>
        <p class="text-sm font-display font-semibold text-base-content/80 group-hover:text-primary transition-colors mt-1">
          {nextTutorial.data.title} →
        </p>
      </a>
    ) : <div />}
  </div>
</DocsLayout>
