---
import DocsLayout from "../../layouts/DocsLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const docs = await getCollection("docs");
  return docs.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Get all docs sorted for prev/next navigation
const allDocs = await getCollection("docs");
const sortedDocs = allDocs.sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));
const currentIndex = sortedDocs.findIndex((d) => d.id === entry.id);
const prevDoc = currentIndex > 0 ? sortedDocs[currentIndex - 1] : null;
const nextDoc = currentIndex < sortedDocs.length - 1 ? sortedDocs[currentIndex + 1] : null;
---

<DocsLayout title={entry.data.title} description={entry.data.description}>
  <Content />

  <!-- Prev/Next navigation -->
  <div slot="pagination" class="flex justify-between gap-4">
    {prevDoc ? (
      <a
        href={`/docs/${prevDoc.id}`}
        class="glass-card rounded-xl p-4 flex-1 group no-underline max-w-[50%]"
      >
        <span class="text-xs text-base-content/40 font-display">Previous</span>
        <p class="text-sm font-display font-semibold text-base-content/80 group-hover:text-primary transition-colors mt-1">
          ← {prevDoc.data.title}
        </p>
      </a>
    ) : <div />}

    {nextDoc ? (
      <a
        href={`/docs/${nextDoc.id}`}
        class="glass-card rounded-xl p-4 flex-1 group no-underline text-right max-w-[50%]"
      >
        <span class="text-xs text-base-content/40 font-display">Next</span>
        <p class="text-sm font-display font-semibold text-base-content/80 group-hover:text-primary transition-colors mt-1">
          {nextDoc.data.title} →
        </p>
      </a>
    ) : <div />}
  </div>
</DocsLayout>
